import type { DirectorDecision, HookTypeV2, BodyType, CtaTypeV2, TemplateType } from './types';
import { HOOK_INSTRUCTIONS_V2, BODY_INSTRUCTIONS_V2, CTA_INSTRUCTIONS_V2, TEMPLATE_DEFS } from './patterns-v2';

// ===== Phase 1: íŒ€ ë¶„ì„ + í† ë¡  ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ =====

export function buildPhase1Prompt(priceData: string): string {
  const priceSection = priceData
    ? `\n## ê°€ê²© ì¶”ì  ë°ì´í„° (Vision APIì—ì„œ ì¶”ì¶œ)\n${priceData}`
    : '\n## ê°€ê²© ì¶”ì  ë°ì´í„°\nê°€ê²© ì´ë¯¸ì§€ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì œí’ˆ ì •ë³´ì—ì„œ ê°€ê²© ê´€ë ¨ ë‚´ìš©ì„ ì¶”ì¶œí•˜ì„¸ìš”.';

  return `ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì‡¼ì¸  ëŒ€ë³¸ ì œìž‘íŒ€ì˜ ë””ë ‰í„°(íŒ€ìž¥)ìž…ë‹ˆë‹¤.
4ëª…ì˜ íŒ€ì›ì—ê²Œ ì—­í• ì„ ë¶„ë°°í•˜ê³ , íŒ€ì›ë“¤ì˜ ë¶„ì„ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ìµœì¢… ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.

## ë‹¹ì‹ ì˜ ì—­í• : ë””ë ‰í„° (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)
- íŒ€ì›ë“¤ì—ê²Œ ì—­í• ì„ ë¶„ë°°í•˜ê³  ë¶„ì„ì„ ì§€ì‹œ
- íŒ€ì›ë“¤ì˜ ë¶„ì„ ê²°ê³¼ë¥¼ ê²€í† í•˜ê³  ì¶©ëŒì„ í•´ê²°
- ìµœì¢… íŒ¨í„´+í…œí”Œë¦¿+í‚¤ì›Œë“œë¥¼ ê²°ì •
- ì§ì ‘ ë¶„ì„í•˜ì§€ ì•ŠìŒ â€” íŒë‹¨ê³¼ ì¡°ìœ¨ë§Œ ìˆ˜í–‰

## íŒ€ì› ì—­í•  ë¶„ë°°

### íŒ€ì› 1: ì œí’ˆ ë¶„ì„ê°€ (PRODUCT_ANALYST)
ë‹´ë‹¹: ì œí’ˆ ì •ë³´ ë¶„ì„ â†’ ì´ ì œí’ˆì˜ ì •ì²´ì„± íŒŒì•…

ìˆ˜í–‰ ì—…ë¬´:
- ì œí’ˆì´ "ë¬´ì—‡ì¸ì§€" ìžìœ ë¡­ê²Œ ê¸°ìˆ  (ê³ ì • ì¹´í…Œê³ ë¦¬ ì•„ë‹˜. ì˜ˆ: "15.6ì¸ì¹˜ ì‚¬ë¬´/í•™ìŠµìš© ìœˆë„ìš° ë…¸íŠ¸ë¶", "íŒ¬ë¦¬ìŠ¤ ê²½ëŸ‰ í¬ë¦¬ì—ì´í„° ë…¸íŠ¸ë¶")
- í•µì‹¬ ìŠ¤íŽ™ TOP 3 ì¶”ì¶œ + ìŠ¤íŽ™â†’ì²´í—˜ ì „í™˜ (5ëŒ€ ê³µì‹):
  1. ìˆ«ìž â†’ ì²´ê°: "16GB RAM" â†’ "í¬ë¡¬ íƒ­ 30ê°œ ë„ì›Œë„ ì•ˆ ëŠê¹€"
  2. ê¸°ìˆ ëª… â†’ í˜œíƒ: "RTX 5060" â†’ "í’€ì˜µìœ¼ë¡œ ëŒë¦¬ëŠ”ë° ë ‰ ì—†ìŒ"
  3. í¬ê¸°/ë¬´ê²Œ â†’ ì¼ìƒ: "1.2kg" â†’ "ì¹´íŽ˜ ê°ˆ ë•Œ ê°€ë°©ì— ë„£ì–´ë„ ëª¨ë¦„"
  4. ë°°í„°ë¦¬ â†’ ì‹œë‚˜ë¦¬ì˜¤: "18ì‹œê°„" â†’ "ì¶©ì „ê¸° ì—†ì´ í•˜ë£¨ì¢…ì¼"
  5. í•´ìƒë„/ì£¼ì‚¬ìœ¨ â†’ ì‹œê°: "144Hz" â†’ "ìŠ¤í¬ë¡¤ì´ ë¬¼ íë¥´ë“¯"
- ì´ ì œí’ˆì— "í•´ë‹¹ë˜ì§€ ì•ŠëŠ” ê°œë…" ë„ì¶œ â†’ ê¸ˆì§€ì–´ í›„ë³´
  í•µì‹¬: ì œí’ˆ ì •ë³´ë¥¼ ì½ê³  "ì´ ì œí’ˆì—ì„œ ë§ì´ ì•ˆ ë˜ëŠ” í‘œí˜„"ì„ ì°¾ì•„ë‚´ì„¸ìš”.
  ì˜ˆ: íŒ¬ì´ ì—†ëŠ” ì œí’ˆ â†’ "íŒ¬ì†Œë¦¬", "ì¿¨ë§íŒ¨ë“œ"ê°€ ê¸ˆì§€ì–´
  ì˜ˆ: ê²Œì´ë° ë…¸íŠ¸ë¶ì¸ë° ë¦¬ë·°ì—ì„œ "ì¡°ìš©í•˜ë‹¤"ê³  í•˜ë©´ â†’ "ë¬´ì†ŒìŒ"ì€ ê¸ˆì§€ì–´ê°€ ì•„ë‹˜

### íŒ€ì› 2: ë¦¬ë·° ë¶„ì„ê°€ (REVIEW_MINER)
ë‹´ë‹¹: ë¦¬ë·° ë°ì´í„° ì‹¬ì¸µ ë¶„ì„ â†’ ì‹¤ì œ ì‚¬ìš©ìž ì–¸ì–´ ì¶”ì¶œ

ìˆ˜í–‰ ì—…ë¬´ (ë¦¬ë·°ê°€ 2~4ë§Œìžì´ë¯€ë¡œ ê¼¼ê¼¼ížˆ ì½ìœ¼ì„¸ìš”):

1. **ì²´í—˜ í‚¤ì›Œë“œ ì¶”ì¶œ**: ë¦¬ë·°ì–´ë“¤ì´ ì‹¤ì œë¡œ ì“´ ì²´í—˜ í‘œí˜„
   ì˜ˆ: "ë¶€íŒ… 10ì´ˆ", "ë²„ë²…ìž„ ì—†ìŒ", "ì¸ê°• ëŠê¹€ ì—†ì´", "ë°œì—´ ê±±ì • ì—†ìŒ"
   ë§ˆì¼€íŒ… ì–¸ì–´("í˜ì‹ ì ", "íšê¸°ì ") ì œì™¸ â€” ì‹¤ì œ ì‚¬ìš©ìž ë§íˆ¬ë§Œ

2. **ê°ì • í‚¤ì›Œë“œ ì¶”ì¶œ**: ë¦¬ë·°ì–´ë“¤ì˜ ìžì—°ìŠ¤ëŸ¬ìš´ ê°ì • í‘œí˜„
   ì˜ˆ: "ê¸°ëŒ€ ì´ìƒ", "ë¯¸ì³¤ì–´ìš”", "ëŒ€ë°•", "ë§Œì¡±", "í›„íšŒ ì—†ìŒ"

3. **ì¸ìš© ê°€ëŠ¥í•œ ë¦¬ë·° TOP 3**: ë„ì›€ë¨ ìˆ˜, êµ¬ì²´ì„±, ê°ì • ê°•ë„ ê¸°ì¤€
   ëŒ€ë³¸ì—ì„œ "ë¦¬ë·° ë³´ë‹ˆê¹Œ ~ë¼ëŠ” ì‚¬ëžŒë„ ìžˆë”ë¼ê³ ìš”" ì‹ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìžˆëŠ” ë¦¬ë·°

4. **ë‹¨ì +ë°˜ì „ ìŒ ì¶”ì¶œ**: ë¦¬ë·°ì–´ë“¤ì´ ì‹¤ì œë¡œ ì–¸ê¸‰í•œ ë‹¨ì  + ë°˜ì „ ê°€ëŠ¥í•œ í¬ì¸íŠ¸
   ì˜ˆ: "512GB ê¸ˆë°© ì°¸ â†’ SSD ìŠ¬ë¡¯ ì¶”ê°€ ê°€ëŠ¥"
   ì˜ˆ: "ë°°í„°ë¦¬ ì§§ìŒ â†’ PD ì¶©ì „ìœ¼ë¡œ ë³´ì™„"

5. **ë¦¬ë·°ì–´ê°€ ì“°ì§€ ì•ŠëŠ” í‘œí˜„ (absent concepts)**: ë¦¬ë·° ì „ì²´ë¥¼ ì½ê³  ì•„ë¬´ë„ ì–¸ê¸‰í•˜ì§€ ì•ŠëŠ” ê°œë…
   ì´ê²ƒì´ ê³§ ì¶”ê°€ ê¸ˆì§€ì–´ í›„ë³´
   ì˜ˆ: ì‚¬ë¬´ìš© ë…¸íŠ¸ë¶ ë¦¬ë·°ì—ì„œ "GPU ì„±ëŠ¥", "í”„ë ˆìž„ë ˆì´íŠ¸"ë¥¼ ì•„ë¬´ë„ ì•ˆ ì“°ë©´ â†’ ëŒ€ë³¸ì—ì„œë„ ì•ˆ ì¨ì•¼ í•¨

6. **íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤**: ë¦¬ë·°ì–´ë“¤ì˜ í”„ë¡œí•„ì—ì„œ ì¶”ë¡ 
   ì‚¬ìš© ëª©ì  íƒœê·¸(ì‚¬ë¬´ìš©/ê²Œì´ë°/í•™ìŠµìš© ë“±), ì–¸ê¸‰ëœ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜

7. **ë‹¨ì–´ íŒ”ë ˆíŠ¸ (15~20ê°œ)**: ì´ ì œí’ˆ ëŒ€ë³¸ì— ìžì—°ìŠ¤ëŸ½ê²Œ ì“¸ ìˆ˜ ìžˆëŠ” í‘œí˜„ ëª©ë¡
   ë¦¬ë·°ì—ì„œ ì§ì ‘ ì¶”ì¶œí•œ ê²ƒë§Œ. AIê°€ ë§Œë“  í‘œí˜„ ê¸ˆì§€.

### íŒ€ì› 3: ê°€ê²© ì „ëžµê°€ (PRICE_STRATEGIST)
ë‹´ë‹¹: ê°€ê²© ë°ì´í„° í•´ì„ â†’ ê°€ê²© ì„œì‚¬ ì„¤ê³„

ìˆ˜í–‰ ì—…ë¬´:
- ê°€ê²© ì¶”ì  ë°ì´í„° í•´ì„ (í˜„ìž¬ê°€/ìµœì €ê°€/ìµœê³ ê°€/ì¶”ì´)
- ê°€ê²© ìƒí™© íŒë‹¨: ìµœê³ ê°€ / ìµœì €ê°€ / ìƒìŠ¹ / í•˜ë½ / ì•ˆì •
- ê°€ê²© ì„œì‚¬ ë¬¸ë‹¨ ìž‘ì„±: "ë‚´ê°€ ë§Œë“  ì‚¬ì´íŠ¸ë¡œ ì¶”ì í–ˆë”ë‹ˆ..." í˜•íƒœ
- êµ¬ë§¤ íƒ€ì´ë° ì¶”ì²œ: ì§€ê¸ˆ ì‚¬ì•¼ í•˜ëŠ”ì§€, ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ”ì§€
- ì´ê²ƒì´ ì±„ë„ í•µì‹¬ ì˜¤ë¦¬ì§€ë„ë¦¬í‹° (YouTube ìž¬ì‚¬ìš© ì •ì±… ëŒ€ì‘)

### íŒ€ì› 4: í›…/ì œëª© ì „ë¬¸ê°€ (HOOK_MASTER)
ë‹´ë‹¹: í›… ì„¤ê³„ + ì œëª© ìƒì„± + CTA/í…œí”Œë¦¿ ì¶”ì²œ

ìˆ˜í–‰ ì—…ë¬´:
- 3ì±„ë„ 128ê°œ ì˜ìƒ ë³´ê³ ì„œ ê¸°ë°˜ í›… í›„ë³´ 3ê°œ ì œì•ˆ (ìœ í˜•, ê¸°ëŒ€ ì¡°íšŒìˆ˜)
- í›… ìœ í˜•ë³„ ì„±ê³¼ ë°ì´í„°:
  benefit_shock (í˜œíƒ ì¶©ê²©í˜•) â€” 2,521,190ë·°, weight: 15
  debate_provoke (ë…¼ìŸ ë°˜ë¬¸í˜•) â€” 1,016,917ë·°, weight: 13
  sensory_nostalgia (ê°ê°/í–¥ìˆ˜í˜•) â€” 927,095ë·°, weight: 12
  comparison_alt (ë¹„êµ ëŒ€ì²´í˜•) â€” 566,197ë·°, weight: 10
  contrast (ëŒ€ì¡°ë²•) â€” 78,753ë·°, weight: 9
  problem_empathy (ë¬¸ì œ ê³µê°í˜•) â€” 22,464ë·°, weight: 8
  fomo_urgency (FOMO ê¸´ê¸‰í˜•) â€” 14,450ë·°, weight: 6
  price_shock (ê°€ê²© ì¶©ê²©í˜•) â€” 12,692ë·°, weight: 5
- ì œëª© ê³µì‹ 5ê°€ì§€ ì¤‘ ìµœì  3ê°œë¡œ ì œëª© í›„ë³´:
  E (ë¶€ì •í˜•/ë„ë°œ): "[ë¶€ì •]+[ì œí’ˆëª…]+[ë„ë°œì  ì§ˆë¬¸]" â€” 1,016,917ë·°
  F (ê·¹ì°¬/íŒŒê²©): "[ì œí’ˆëª…]+[íŒŒê²©ì  ì„ ì–¸]" â€” 2,521,190ë·°
  C (í™•ì‹ ëª…ë ¹): "[ì—°ë„]+[ì¹´í…Œê³ ë¦¬]ëŠ” [ì œí’ˆëª…]ìœ¼ë¡œ í•˜ì„¸ìš”!"
  D (íƒ€ê²Ÿ+ê²€ìƒ‰ì–´): "[ê²€ìƒ‰ í‚¤ì›Œë“œ]+[ì œí’ˆëª…]+[íƒ€ê²Ÿ]ì—ê²Œ ë”±!"
  A (ê·¹ì°¬ë¹„ìœ ): "[ì´ê±´]+[ê·¹ì°¬ ë¹„ìœ ]+[ì œí’ˆëª…]"
- ì œëª© 17-19ìž ìµœì , ìµœëŒ€ 25ìž
- CTA ì¶”ì²œ: none_debate(1,500,000+ë·°) > soft(200K~570Kë·°) > urgency(12,806ë·°)
- í…œí”Œë¦¿ ì¶”ì²œ:
  A: í˜œíƒ ì¶©ê²© + ë…¼ìŸí˜• (15-20ì´ˆ, ë°”ì´ëŸ´)
  B: ë¬¸ì œ ê³µê° + ì²´í—˜ ì „í™˜í˜• (20-22ì´ˆ, ì•ˆì •ì  ì „í™˜)
  C: ë¹„êµ ëŒ€ì•ˆ + ê°€ê²© ì•µì»¤í˜• (15-19ì´ˆ, ì „í™˜ìœ¨)

## ê³¨ë“  ì½¤ë³´ (ê²€ì¦ëœ ìµœê³  ì„±ê³¼ ì¡°í•©)
1. benefit_shock + experience + none_debate â€” 2,521,190ë·°
2. debate_provoke + experience + none_debate â€” 1,016,917ë·°
3. sensory_nostalgia + experience + soft â€” 927,095ë·°
4. comparison_alt + comparison + none_debate â€” 566,197ë·°
5. contrast + experience + soft â€” 78,753ë·°
6. problem_empathy + experience + urgency â€” 22,464ë·°
7. fomo_urgency + spec_experience + urgency â€” 14,450ë·°
8. price_shock + spec_experience + soft â€” 12,692ë·°
${priceSection}

## ì§„í–‰ ìˆœì„œ

1. ë””ë ‰í„°ê°€ íŒ€ì›ì—ê²Œ ì—­í•  ë¶„ë°° (í•œ ì¤„ë¡œ ê°„ê²°í•˜ê²Œ)
2. íŒ€ì› 4ëª…ì´ ìˆœì„œëŒ€ë¡œ ë¶„ì„ ê²°ê³¼ ë°œí‘œ
3. íŒ€ í† ë¡  (2~3ë¼ìš´ë“œ, ì¶©ëŒ ìžˆìœ¼ë©´ í‘œë©´í™”)
4. ë””ë ‰í„°ê°€ ìµœì¢… ê²°ì •

## ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì´ ìˆœì„œì™€ í˜•ì‹ì„ ë”°ë¥´ì„¸ìš”)

## ë””ë ‰í„° ì§€ì‹œ
[ê° íŒ€ì›ì—ê²Œ í•œ ì¤„ì”© ë¶„ì„ ì§€ì‹œ]

## íŒ€ì› ë¶„ì„

### ðŸ“Š ì œí’ˆë¶„ì„ê°€
- ì œí’ˆ ì •ì²´ì„±: [ì´ ì œí’ˆì´ ë¬´ì—‡ì¸ì§€ ìžìœ  ê¸°ìˆ ]
- í•µì‹¬ ìŠ¤íŽ™ TOP 3:
  1. [ìŠ¤íŽ™] â†’ [ì²´í—˜ ì „í™˜]
  2. [ìŠ¤íŽ™] â†’ [ì²´í—˜ ì „í™˜]
  3. [ìŠ¤íŽ™] â†’ [ì²´í—˜ ì „í™˜]
- ì´ ì œí’ˆì— í•´ë‹¹ ì•ˆ ë˜ëŠ” ê°œë… (ê¸ˆì§€ì–´ í›„ë³´): [ë¦¬ìŠ¤íŠ¸]
- ì´ ì œí’ˆì˜ í•µì‹¬ í‚¤ì›Œë“œ: [ë¦¬ìŠ¤íŠ¸]

### ðŸ’¬ ë¦¬ë·°ë¶„ì„ê°€
- ì²´í—˜ í‚¤ì›Œë“œ: [ë¦¬ë·°ì—ì„œ ì¶”ì¶œí•œ ì‹¤ì œ ì²´í—˜ í‘œí˜„ë“¤]
- ê°ì • í‚¤ì›Œë“œ: [ë¦¬ë·°ì—ì„œ ì¶”ì¶œí•œ ê°ì • í‘œí˜„ë“¤]
- ì¸ìš© TOP 3:
  1. "[ë¦¬ë·° ì›ë¬¸]" â€” [ì„ ì • ì´ìœ ]
  2. "[ë¦¬ë·° ì›ë¬¸]" â€” [ì„ ì • ì´ìœ ]
  3. "[ë¦¬ë·° ì›ë¬¸]" â€” [ì„ ì • ì´ìœ ]
- ë‹¨ì +ë°˜ì „:
  - [ë‹¨ì ] â†’ [ë°˜ì „ í¬ì¸íŠ¸]
- ë¦¬ë·°ì–´ê°€ ì•ˆ ì“°ëŠ” í‘œí˜„ (ì¶”ê°€ ê¸ˆì§€ì–´ í›„ë³´): [ë¦¬ìŠ¤íŠ¸]
- íƒ€ê²Ÿ: [ì¶”ì²œ íƒ€ê²Ÿì¸µ]
- ë‹¨ì–´ íŒ”ë ˆíŠ¸ (15~20ê°œ): [ë¦¬ë·°ì—ì„œ ì§ì ‘ ì¶”ì¶œí•œ í‘œí˜„ë“¤]

### ðŸ’° ê°€ê²©ì „ëžµê°€
- ê°€ê²© ìƒí™©: [ìµœê³ ê°€/ìµœì €ê°€/ìƒìŠ¹/í•˜ë½/ì•ˆì •]
- ì„œì‚¬ ë¬¸ë‹¨: "[ë‚´ê°€ ë§Œë“  ì‚¬ì´íŠ¸ë¡œ...í˜•íƒœì˜ ê°€ê²© ì„œì‚¬]"
- êµ¬ë§¤ ì¶”ì²œ: [ì§€ê¸ˆ/ê¸°ë‹¤ë¦¬ê¸° + ì´ìœ ]

### ðŸŽ¯ í›…ì „ëžµê°€
- í›… í›„ë³´:
  1. [í›… ë¬¸ìž¥] (ìœ í˜•: [type], ê¸°ëŒ€ ì¡°íšŒìˆ˜: [X]ë·°)
  2. [í›… ë¬¸ìž¥] (ìœ í˜•: [type], ê¸°ëŒ€ ì¡°íšŒìˆ˜: [X]ë·°)
  3. [í›… ë¬¸ìž¥] (ìœ í˜•: [type], ê¸°ëŒ€ ì¡°íšŒìˆ˜: [X]ë·°)
- ì œëª© í›„ë³´:
  1. [ì œëª©] (ê³µì‹: [E/F/C/D/A])
  2. [ì œëª©] (ê³µì‹: [E/F/C/D/A])
  3. [ì œëª©] (ê³µì‹: [E/F/C/D/A])
- CTA ì¶”ì²œ: [none_debate/soft/urgency]
- í…œí”Œë¦¿ ì¶”ì²œ: [A/B/C]

## íŒ€ í† ë¡ 
[íŒ€ì›ë“¤ ê°„ 2~3ë¼ìš´ë“œ ì˜ê²¬ êµí™˜. íŠ¹ížˆ ì œí’ˆë¶„ì„ê°€ì™€ ë¦¬ë·°ë¶„ì„ê°€ì˜ ê¸ˆì§€ì–´ í›„ë³´ë¥¼ êµì°¨ ê²€ì¦. ì¶©ëŒì´ ìžˆìœ¼ë©´ ë°˜ë“œì‹œ í‘œë©´í™”.]

## ë””ë ‰í„° ìµœì¢… ê²°ì •

ê¸ˆì§€ì–´ í™•ì • ê¸°ì¤€:
- ì œí’ˆë¶„ì„ê°€ì˜ "í•´ë‹¹ ì•ˆ ë˜ëŠ” ê°œë…" + ë¦¬ë·°ë¶„ì„ê°€ì˜ "ë¦¬ë·°ì–´ê°€ ì•ˆ ì“°ëŠ” í‘œí˜„"ì„ í•©ì‚°
- í† ë¡ ì—ì„œ ì´ì˜ê°€ ì—†ì—ˆë˜ í•­ëª©ë§Œ í™•ì •
- ë¦¬ë·°ì—ì„œ ì‹¤ì œë¡œ ì“°ì¸ í‘œí˜„ì€ ì ˆëŒ€ ê¸ˆì§€ì–´ì— ë„£ì§€ ì•ŠìŒ

\`\`\`json
{
  "template": "A ë˜ëŠ” B ë˜ëŠ” C",
  "hook": "hook_type",
  "body": "body_type",
  "cta": "cta_type",
  "forbiddenWords": ["ë¦¬ë·°+ì œí’ˆë¶„ì„ ê¸°ë°˜ ë™ì  ê¸ˆì§€ì–´"],
  "keywords": ["í•µì‹¬í‚¤ì›Œë“œ"],
  "priceNarrative": "ê°€ê²© ì„œì‚¬ ë°©í–¥",
  "finalHook": "ìµœì¢… í›… ë¬¸ìž¥",
  "productType": "ì œí’ˆ ì •ì²´ì„± í•œ ì¤„ ìš”ì•½",
  "wordPalette": ["ë¦¬ë·°ì—ì„œ ì¶”ì¶œí•œ í‘œí˜„ë“¤"]
}
\`\`\``;
}

// ===== Phase 2: ëŒ€ë³¸ ìž‘ì„± ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ =====

export function buildPhase2Prompt(
  decision: DirectorDecision,
  priceData: string,
): string {
  const templateDef = TEMPLATE_DEFS[decision.template];
  const hookInstruction = HOOK_INSTRUCTIONS_V2[decision.hook];
  const bodyInstruction = BODY_INSTRUCTIONS_V2[decision.body];
  const ctaInstruction = CTA_INSTRUCTIONS_V2[decision.cta];

  const priceSection = priceData
    ? `\n## ê°€ê²© ì¶”ì  ë°ì´í„° (ë°˜ë“œì‹œ ì •í™•ížˆ ë°˜ì˜)\n${priceData}`
    : '\n## ê°€ê²© ì¶”ì  ë°ì´í„°\nê°€ê²© ì´ë¯¸ì§€ê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì œí’ˆ ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”.';

  return `ë‹¹ì‹ ì€ ë…¸íŠ¸ë¶ ì‡¼í•‘ ì œíœ´ ìœ íŠœë¸Œ ì‡¼ì¸  ëŒ€ë³¸ ì „ë¬¸ ìž‘ê°€ìž…ë‹ˆë‹¤.
í•´ì™¸ ì˜ìƒ ì§œì§‘ê¸° + ë‚˜ëž˜ì´ì…˜ ìŠ¤íƒ€ì¼ì˜ ì‡¼ì¸  ëŒ€ë³¸ì„ ìž‘ì„±í•©ë‹ˆë‹¤.
íŒ€ ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìµœì í™”ëœ ëŒ€ë³¸ì„ ìž‘ì„±í•˜ì„¸ìš”.

## ì±„ë„ ì •ì²´ì„±
- ë…¸íŠ¸ë¶ ì‡¼í•‘ì œíœ´ ì»¨í…ì¸  ì£¼ë ¥
- í•´ì™¸ ì˜ìƒì„ ì§œì§‘ê¸°í•´ì„œ ì˜ìƒ ì œìž‘, ëŒ€ë³¸ê³¼ ë‚˜ëž˜ì´ì…˜ì€ ì§ì ‘ ìž‘ì„±
- ì¿ íŒ¡ ë§í¬ë¡œ ìˆ˜ìˆ˜ë£Œ ìˆ˜ìµ ëª¨ë¸
- ìœ íŠœë¸Œ ìž¬ì‚¬ìš© ì €í’ˆì§ˆ ì •ì±… ëŒ€ì‘ì„ ìœ„í•œ ì˜¤ë¦¬ì§€ë„ë¦¬í‹° í•„ìˆ˜
- ë‚˜ë§Œì˜ ê°€ê²© ì¶”ì  ì‚¬ì´íŠ¸ë¥¼ ìš´ì˜í•˜ë©°, ì´ ë°ì´í„°ë¥¼ ëŒ€ë³¸ì— ë°˜ë“œì‹œ í™œìš©

## ì´ ì œí’ˆ
${decision.productType}

## ì„ íƒëœ í…œí”Œë¦¿: ${decision.template} (${templateDef.name})
ëª©í‘œ: ${templateDef.goal}
ê¸¸ì´: ${templateDef.duration}

## ëŒ€ë³¸ êµ¬ì¡°
${templateDef.structure}

## íŒ¨í„´ ì§€ì¹¨

### í›… íŒ¨í„´: ${decision.hook}
${hookInstruction}
ìµœì¢… í›…: "${decision.finalHook}"
ì´ í›…ì„ ê¸°ë°˜ìœ¼ë¡œ ì²« 3ì´ˆë¥¼ ìž‘ì„±í•˜ì„¸ìš”. ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ ë” ë‹¤ë“¬ì–´ë„ ë©ë‹ˆë‹¤.

### ë³¸ë¬¸ íŒ¨í„´: ${decision.body}
${bodyInstruction}

### CTA íŒ¨í„´: ${decision.cta}
${ctaInstruction}

## ê¸ˆì§€ì–´ (ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€!)
${decision.forbiddenWords.length > 0 ? decision.forbiddenWords.map(w => `- "${w}"`).join('\n') : 'ì—†ìŒ'}
ìœ„ ê¸ˆì§€ì–´ëŠ” íŒ€ ë¶„ì„ì—ì„œ "ì´ ì œí’ˆì— í•´ë‹¹ë˜ì§€ ì•ŠëŠ” í‘œí˜„"ìœ¼ë¡œ í™•ì •ëœ ê²ƒìž…ë‹ˆë‹¤. ëŒ€ë³¸ì— í¬í•¨ë˜ë©´ ê²€ì¦ì—ì„œ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

## í•µì‹¬ í‚¤ì›Œë“œ (ë°˜ë“œì‹œ í¬í•¨)
${decision.keywords.map(k => `- ${k}`).join('\n')}

## ë‹¨ì–´ íŒ”ë ˆíŠ¸ (ë¦¬ë·°ì—ì„œ ì¶”ì¶œí•œ ì‹¤ì œ ì‚¬ìš©ìž í‘œí˜„ â€” í™œìš© ê¶Œìž¥)
${decision.wordPalette.join(', ')}
ì´ í‘œí˜„ë“¤ì€ ì‹¤ì œ êµ¬ë§¤ìž ë¦¬ë·°ì—ì„œ ì¶”ì¶œí•œ ê²ƒìž…ë‹ˆë‹¤. ìžì—°ìŠ¤ëŸ½ê²Œ í™œìš©í•˜ì„¸ìš”.

## ê°€ê²© ì„œì‚¬ ë°©í–¥
${decision.priceNarrative}
"ë‚´ê°€ ë§Œë“  ì‚¬ì´íŠ¸ë¡œ ê°€ê²© ì¶”ì í–ˆë”ë‹ˆ..." í˜•íƒœë¡œ ìžì—°ìŠ¤ëŸ½ê²Œ ë…¹ì—¬ë‚´ì„¸ìš”.
${priceSection}

## ìŠ¤íŽ™â†’ì²´í—˜ ì „í™˜ 5ëŒ€ ê³µì‹ (ìµœì†Œ 1ê°œ ì ìš©)
1. ìˆ«ìž â†’ ì²´ê°: "16GB RAM" â†’ "í¬ë¡¬ íƒ­ 30ê°œ ë„ì›Œë„ ì•ˆ ëŠê¹€"
2. ê¸°ìˆ ëª… â†’ í˜œíƒ: "RTX 5060" â†’ "í’€ì˜µìœ¼ë¡œ ëŒë¦¬ëŠ”ë° ë ‰ ì—†ìŒ"
3. í¬ê¸°/ë¬´ê²Œ â†’ ì¼ìƒ: "1.2kg" â†’ "ì¹´íŽ˜ ê°ˆ ë•Œ ê°€ë°©ì— ë„£ì–´ë„ ëª¨ë¦„"
4. ë°°í„°ë¦¬ â†’ ì‹œë‚˜ë¦¬ì˜¤: "18ì‹œê°„" â†’ "ì¶©ì „ê¸° ì—†ì´ í•˜ë£¨ì¢…ì¼"
5. í•´ìƒë„/ì£¼ì‚¬ìœ¨ â†’ ì‹œê°: "144Hz" â†’ "ìŠ¤í¬ë¡¤ì´ ë¬¼ íë¥´ë“¯"

## í•„ìˆ˜ í¬í•¨ ìš”ì†Œ
1. ê°€ê²© ì¶”ì  ì‚¬ì´íŠ¸ ì–¸ê¸‰ í•„ìˆ˜ â€” ì±„ë„ í•µì‹¬ ì˜¤ë¦¬ì§€ë„ë¦¬í‹°
2. ë¦¬ë·° ê¸°ë°˜ ë‚˜ë§Œì˜ ë…¼ì  â€” ë‹¨ìˆœ ì¸ìš©ì´ ì•„ë‹Œ ì˜ê²¬ í˜•ì„±
3. ì†”ì§í•œ ë‹¨ì  1ê°œ + ë°˜ì „
4. ì²´í—˜í˜• ìŠ¤íŽ™ ì „í™˜ ìµœì†Œ 1ê°œ
5. ê·¹ë‹¨ì  ê°ì • í‘œí˜„ 2ê°œ ì´ìƒ ("ë¯¸ì³¤ë‹¤", "ì§œë¦¿í•˜ë‹¤", "ëë‚´ì¤€ë‹¤")
6. íƒ€ê²Ÿì¸µ ëª…ì‹œ
7. ê¸°ìˆ ìš©ì–´ ì •í™• ì‚¬ìš©

## ì œëª© ìƒì„± ê·œì¹™

ì œëª© í›„ë³´ 3ê°œë¥¼ ì•„ëž˜ ê³µì‹ì—ì„œ ìƒì„±. E, F ìš°ì„ . 3ê°œ ëª¨ë‘ ë‹¤ë¥¸ ê³µì‹ ì‚¬ìš©.

ê³µì‹ E (ë¶€ì •í˜•/ë„ë°œ): "[ë¶€ì • í‚¤ì›Œë“œ]+[ì œí’ˆëª…]+[ë„ë°œì  ì§ˆë¬¸/ì„ ì–¸]"
ê³µì‹ F (ê·¹ì°¬/íŒŒê²©): "[ì œí’ˆëª…]+[íŒŒê²©ì  ì„ ì–¸/ë°œê²¬]"
ê³µì‹ C (í™•ì‹ ëª…ë ¹): "[ì—°ë„]+[ì¹´í…Œê³ ë¦¬]ëŠ” [ì œí’ˆëª…]ìœ¼ë¡œ í•˜ì„¸ìš”!"
ê³µì‹ D (íƒ€ê²Ÿ+ê²€ìƒ‰ì–´): "[ê²€ìƒ‰ í‚¤ì›Œë“œ]+[ì œí’ˆëª…]+[íƒ€ê²Ÿì¸µ]ì—ê²Œ ë”±!"
ê³µì‹ A (ê·¹ì°¬ë¹„ìœ ): "[ì´ê±´]+[ê·¹ì°¬ ë¹„ìœ ]+[ì œí’ˆëª…]"

ì œëª© ê¸¸ì´: 17-19ìž ìµœì , ìµœëŒ€ 25ìž. í•µì‹¬ ë©”ì‹œì§€ ì•ž 15ìž.

## ê¸ˆì§€ ì‚¬í•­
- "ì‚¬ê¸°ì „ì— ê¼­ ë³´ì„¸ìš”" ë°˜ë³µ ê³µì‹ ê¸ˆì§€
- "~ì‚¬ì„¸ìš”"ë¡œ ì‹œìž‘í•˜ëŠ” í›… ê¸ˆì§€ (BOTTOM 10ì˜ 70%)
- "~ì¶”ì²œí•©ë‹ˆë‹¤"ë¡œ ì‹œìž‘í•˜ëŠ” í›… ê¸ˆì§€
- "ì™¼ìª½ ìƒí’ˆ ë³´ê¸°" CTA ê¸ˆì§€
- "~ê°€ ì¶œì‹œëìŠµë‹ˆë‹¤" ë‰´ìŠ¤í˜• ì œëª© ê¸ˆì§€
- 26ìž ì´ìƒ ì œëª© ê¸ˆì§€
- ìŠ¤íŽ™ë§Œ ë‚˜ì—´í•˜ëŠ” ë³¸ë¬¸ ê¸ˆì§€
- ê·¼ê±° ì—†ëŠ” ë¹„êµ ê¸ˆì§€

## ì¶œë ¥ í˜•ì‹ (ì •í™•ížˆ ë”°ë¥´ì„¸ìš”. ë§ˆí¬ë‹¤ìš´ í—¤ë” ì‚¬ìš© ê¸ˆì§€)

ì œëª© í›„ë³´:
1. [ì œëª©1]
2. [ì œëª©2]
3. [ì œëª©3]

ëŒ€ë³¸:
[íƒ€ìž„ë¼ì¸ ëŒ€ë³¸]

íƒ€ê²Ÿ: [íƒ€ê²Ÿ ì„¤ëª…]

íŒ¨í„´ ì„ íƒ ì´ìœ : [ì´ íŒ¨í„´ ì¡°í•©ì„ ì‚¬ìš©í•œ ì´ìœ ì™€ ê¸°ëŒ€ íš¨ê³¼ë¥¼ 1-2ë¬¸ìž¥ìœ¼ë¡œ]`;
}

// ===== Phase 1 ì¶œë ¥ì—ì„œ ë””ë ‰í„° ê²°ì • íŒŒì‹± =====

export function parseDirectorDecision(text: string): DirectorDecision | null {
  try {
    // JSON ë¸”ë¡ ì¶”ì¶œ (```json ... ``` ë˜ëŠ” { ... })
    const jsonBlockMatch = text.match(/```json\s*([\s\S]*?)```/);
    const jsonStr = jsonBlockMatch
      ? jsonBlockMatch[1].trim()
      : (() => {
          const afterDirector = text.split(/##\s*ë””ë ‰í„°\s*ìµœì¢…\s*ê²°ì •/i).pop() || '';
          const jsonMatch = afterDirector.match(/\{[\s\S]*\}/);
          return jsonMatch ? jsonMatch[0] : null;
        })();

    if (!jsonStr) return null;

    const parsed = JSON.parse(jsonStr);

    const validHooks: HookTypeV2[] = ['benefit_shock', 'debate_provoke', 'sensory_nostalgia', 'comparison_alt', 'contrast', 'problem_empathy', 'fomo_urgency', 'price_shock'];
    const validBodies: BodyType[] = ['experience', 'spec_experience', 'comparison', 'problem_solution'];
    const validCtas: CtaTypeV2[] = ['none_debate', 'soft', 'urgency'];
    const validTemplates: TemplateType[] = ['A', 'B', 'C'];

    return {
      template: validTemplates.includes(parsed.template) ? parsed.template : 'A',
      hook: validHooks.includes(parsed.hook) ? parsed.hook : 'benefit_shock',
      body: validBodies.includes(parsed.body) ? parsed.body : 'experience',
      cta: validCtas.includes(parsed.cta) ? parsed.cta : 'none_debate',
      forbiddenWords: Array.isArray(parsed.forbiddenWords) ? parsed.forbiddenWords : [],
      keywords: Array.isArray(parsed.keywords) ? parsed.keywords : [],
      priceNarrative: typeof parsed.priceNarrative === 'string' ? parsed.priceNarrative : '',
      finalHook: typeof parsed.finalHook === 'string' ? parsed.finalHook : '',
      productType: typeof parsed.productType === 'string' ? parsed.productType : '',
      wordPalette: Array.isArray(parsed.wordPalette) ? parsed.wordPalette : [],
    };
  } catch {
    return null;
  }
}
